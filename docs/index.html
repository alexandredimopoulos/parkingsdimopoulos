<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Parkings Montpellier — Corrélations voiture ↔ vélo</title>
    <link rel="stylesheet" href="./assets/style.css" />
    <!-- Plotly pour la heatmap (CDN) -->
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js" defer></script>
    <script src="./assets/app.js" defer></script>
  </head>
  <body>
    <header class="container">
      <h1>Parkings Montpellier — Corrélations voiture ↔ vélo</h1>
      <p class="muted">
        Données mises à jour automatiquement par GitHub Actions (toutes les heures) et publiées sur GitHub Pages.
      </p>
      <div class="cards">
        <div class="card">
          <div class="card-title">Dernière mise à jour</div>
          <div id="lastUpdate" class="card-value">…</div>
          <div id="sources" class="card-foot muted">…</div>
        </div>
        <div class="card">
          <div class="card-title">Analyse</div>
          <div id="analysisInfo" class="card-value">…</div>
          <div class="card-foot muted">Corrélations sur les variations (Δ) de places libres.</div>
        </div>
      </div>
    </header>

    <main class="container">
      <section>
        <h2>Disponibilités en temps réel</h2>
        <div class="grid-2">
          <div>
            <h3>Parkings voitures</h3>
            <input id="searchCars" class="search" type="search" placeholder="Rechercher un parking voiture…" />
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th class="num">Places libres</th>
                    <th class="num">Total</th>
                  </tr>
                </thead>
                <tbody id="carsTable"></tbody>
              </table>
            </div>
          </div>

          <div>
            <h3>Stations vélo (Vélomagg)</h3>
            <input id="searchBikes" class="search" type="search" placeholder="Rechercher une station vélo…" />
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th class="num">Places libres</th>
                    <th class="num">Total</th>
                  </tr>
                </thead>
                <tbody id="bikesTable"></tbody>
              </table>
            </div>
            <p class="muted small">
              Pour les vélos, on affiche les <strong>places de stationnement disponibles</strong> (freeSlotNumber).
            </p>
          </div>
        </div>
      </section>

      <section>
        <h2>Corrélations et logique géographique</h2>
        <p class="muted">
          On calcule la corrélation de Pearson entre les variations (Δ) de places libres.
          Une corrélation <strong>négative</strong> indique que lorsque l'un augmente, l'autre diminue (et inversement).
        </p>

        <div class="controls">
          <label>
            Distance max (km)
            <input id="maxDistance" type="range" min="0.5" max="6" step="0.5" value="2" />
            <span id="maxDistanceValue" class="pill">2 km</span>
          </label>
          <label>
            |corrélation| min
            <input id="minAbsCorr" type="range" min="0" max="1" step="0.05" value="0.25" />
            <span id="minAbsCorrValue" class="pill">0.25</span>
          </label>

          <label>
            <input id="onlyNegative" type="checkbox" checked />
            corrélation négative seulement
          </label>
        </div>

        <h3>Heatmap (voiture × vélo)</h3>
        <div id="heatmap" class="plot"></div>
        <p class="muted small">
          Les cellules vides correspondent à des paires filtrées (distance trop grande / corrélation trop faible / pas assez de points communs).
        </p>

        <h3>Classement des paires les plus liées</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Parking voiture</th>
                <th>Station vélo</th>
                <th class="num">Corrélation</th>
                <th class="num">Distance (km)</th>
                <th class="num">Points</th>
                <th class="num">Score</th>
              </tr>
            </thead>
            <tbody id="pairsTable"></tbody>
          </table>
        </div>

        <details class="details">
          <summary>Pourquoi une pondération par distance ?</summary>
          <p>
            Une corrélation statistique peut apparaître entre deux lieux sans lien réel (effet "ville entière", météo, horaires, etc.).
            Pour rendre le résultat plus plausible, on réduit le score quand la distance augmente.
          </p>
        </details>

        <h3>Classement local (par parking / station)</h3>
        <div class="grid-2">
          <div>
            <h4>Depuis un parking voiture</h4>
            <select id="carSelect" class="select"></select>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Station vélo</th>
                    <th class="num">Corrélation</th>
                    <th class="num">Distance (km)</th>
                    <th class="num">Points</th>
                    <th class="num">Score</th>
                  </tr>
                </thead>
                <tbody id="carLinks"></tbody>
              </table>
            </div>
          </div>

          <div>
            <h4>Depuis une station vélo</h4>
            <select id="bikeSelect" class="select"></select>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Parking voiture</th>
                    <th class="num">Corrélation</th>
                    <th class="num">Distance (km)</th>
                    <th class="num">Points</th>
                    <th class="num">Score</th>
                  </tr>
                </thead>
                <tbody id="bikeLinks"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>Fichiers générés</h2>
        <ul>
          <li><a href="./data/latest_snapshot.json">latest_snapshot.json</a> (disponibilités temps réel)</li>
          <li><a href="./data/correlations.json">correlations.json</a> (corrélations + classements)</li>
          <li><a href="./data/metadata.json">metadata.json</a> (coordonnées)</li>
        </ul>
      </section>
    </main>

    <footer class="container muted small">
      <p>
        Projet SAE / mini-projet — Montpellier Méditerranée Métropole (Open Data). Les données proviennent des endpoints publics (format NGSI/FIWARE).
      </p>
    </footer>
  </body>
</html>
